{"openapi":"3.0.0","paths":{"/api/v1/clientes/registro":{"post":{"description":"Registra un nuevo cliente en la billetera virtual. El documento y email deben ser únicos. Saldo inicial: 0.","operationId":"ClienteController_registrarCliente","parameters":[],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/RegistroClienteDto"}}}},"responses":{"201":{"description":"","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ClienteEntity"}}}}},"security":[{"api-key":[]}],"summary":"Registrar un nuevo cliente","tags":["Clientes"]}},"/api/v1/billetera/recarga":{"post":{"description":"Carga dinero a la billetera de un cliente. Requiere documento, celular y monto mayor a 0.","operationId":"BilleteraController_recargarBilletera","parameters":[],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/RecargaBilleteraDto"}}}},"responses":{"200":{"description":"","content":{"application/json":{"schema":{"$ref":"#/components/schemas/RecargaResponseEntity"}}}}},"security":[{"api-key":[]}],"summary":"Recargar saldo a la billetera","tags":["Billetera"]}},"/api/v1/billetera/pagar":{"post":{"description":"Genera un token de 6 dígitos y lo envía al email del cliente. El token expira en 15 minutos y solo se puede usar una vez.","operationId":"BilleteraController_iniciarPago","parameters":[],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/PagarDto"}}}},"responses":{"200":{"description":"","content":{"application/json":{"schema":{"$ref":"#/components/schemas/PagoIniciadoEntity"}}}}},"security":[{"api-key":[]}],"summary":"Iniciar proceso de pago","tags":["Billetera"]}},"/api/v1/billetera/confirmar-pago":{"post":{"description":"Confirma el pago usando el ID de sesión y el token recibido por email. Valida que no esté expirado ni usado, y descuenta el monto del saldo.","operationId":"BilleteraController_confirmarPago","parameters":[],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/ConfirmarPagoDto"}}}},"responses":{"200":{"description":"","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ConfirmarPagoResponseEntity"}}}}},"security":[{"api-key":[]}],"summary":"Confirmar pago con token","tags":["Billetera"]}},"/api/v1/billetera/saldo":{"get":{"description":"Consulta el saldo actual de un cliente e incluye estadísticas de transacciones (recargas y compras).","operationId":"BilleteraController_consultarSaldo","parameters":[{"name":"documento","required":true,"in":"query","description":"Número de documento del cliente","schema":{"example":"12345678","type":"string"}},{"name":"celular","required":true,"in":"query","description":"Número de celular del cliente","schema":{"example":"3001234567","type":"string"}}],"responses":{"200":{"description":"","content":{"application/json":{"schema":{"$ref":"#/components/schemas/SaldoResponseEntity"}}}}},"security":[{"api-key":[]}],"summary":"Consultar saldo de la billetera","tags":["Billetera"]}}},"info":{"title":"Billetera Virtual - Servidor Database","description":"Api documentacion","version":"1.0","contact":{}},"tags":[],"servers":[{"url":"http://localhost:3000"}],"components":{"schemas":{"RegistroClienteDto":{"type":"object","properties":{"documento":{"type":"string","minLength":3,"maxLength":20,"description":"Número de documento de identidad del cliente","example":"12345678"},"nombres":{"type":"string","minLength":3,"maxLength":100,"description":"Nombres completos del cliente","example":"Juan Pérez"},"email":{"type":"string","format":"email","description":"Email del cliente","example":"juan@email.com"},"celular":{"type":"string","minLength":10,"maxLength":15,"description":"Número de teléfono celular del cliente","example":"3001234567"}},"required":["documento","nombres","email","celular"]},"ClienteEntity":{"type":"object","properties":{"id":{"type":"number","example":1,"description":"ID único del cliente"},"documento":{"type":"string","example":"1234567890","description":"Documento de identidad del cliente"},"nombres":{"type":"string","example":"Juan Pérez García","description":"Nombre completo del cliente"},"email":{"type":"string","example":"juan.perez@example.com","description":"Email del cliente"},"celular":{"type":"string","example":"3001234567","description":"Número de celular del cliente"},"saldo":{"type":"string","example":100000,"description":"Saldo actual de la billetera"},"createdAt":{"format":"date-time","type":"string","example":"2025-11-05T22:25:26.000Z","description":"Fecha de creación"},"updatedAt":{"format":"date-time","type":"string","example":"2025-11-05T22:25:26.000Z","description":"Fecha de última actualización"}},"required":["id","documento","nombres","email","celular","saldo","createdAt","updatedAt"]},"RecargaBilleteraDto":{"type":"object","properties":{"documento":{"type":"string","description":"Número de documento de identidad del cliente","example":"12345678"},"celular":{"type":"string","description":"Número de teléfono celular del cliente","example":"3001234567"},"monto":{"type":"number","minimum":0.01,"description":"Monto a recargar en la billetera","example":50000}},"required":["documento","celular","monto"]},"ClienteRecargaEntity":{"type":"object","properties":{"documento":{"type":"string","example":"1234567890","description":"Documento del cliente"},"nombres":{"type":"string","example":"Juan Pérez García","description":"Nombre del cliente"}},"required":["documento","nombres"]},"RecargaResponseEntity":{"type":"object","properties":{"cliente":{"$ref":"#/components/schemas/ClienteRecargaEntity"},"montoRecargado":{"type":"number","example":50000,"description":"Monto recargado"},"saldoAnterior":{"type":"string","example":"100000","description":"Saldo anterior"},"saldoNuevo":{"type":"string","example":"150000","description":"Saldo nuevo"}},"required":["cliente","montoRecargado","saldoAnterior","saldoNuevo"]},"PagarDto":{"type":"object","properties":{"documento":{"type":"string","description":"Número de documento de identidad del cliente","example":"12345678"},"celular":{"type":"string","description":"Número de teléfono celular del cliente","example":"3001234567"},"monto":{"type":"number","minimum":0.01,"description":"Monto de la compra a realizar","example":25000}},"required":["documento","celular","monto"]},"PagoIniciadoEntity":{"type":"object","properties":{"id_sesion":{"type":"string","example":"550e8400-e29b-41d4-a716-446655440000","description":"ID de la sesión de pago"}},"required":["id_sesion"]},"ConfirmarPagoDto":{"type":"object","properties":{"id_sesion":{"type":"string","format":"uuid","description":"ID de la sesión de compra generado al iniciar el pago","example":"550e8400-e29b-41d4-a716-446655440000"},"token":{"type":"string","minLength":6,"maxLength":6,"pattern":"/^[0-9]{6}$/","description":"Token de confirmación de 6 dígitos enviado al email","example":"123456"}},"required":["id_sesion","token"]},"ClienteConfirmacionEntity":{"type":"object","properties":{"documento":{"type":"string","example":"1234567890","description":"Documento del cliente"},"nombres":{"type":"string","example":"Juan Pérez García","description":"Nombre del cliente"}},"required":["documento","nombres"]},"ConfirmarPagoResponseEntity":{"type":"object","properties":{"cliente":{"$ref":"#/components/schemas/ClienteConfirmacionEntity"},"montoDescontado":{"type":"string","example":"25000","description":"Monto descontado"},"saldoAnterior":{"type":"string","example":"150000","description":"Saldo anterior"},"saldoNuevo":{"type":"string","example":"125000","description":"Saldo nuevo"},"fechaTransaccion":{"type":"string","example":"2025-11-05T10:35:00.000Z","description":"Fecha de la transacción"}},"required":["cliente","montoDescontado","saldoAnterior","saldoNuevo","fechaTransaccion"]},"ClienteSaldoEntity":{"type":"object","properties":{"documento":{"type":"string","example":"1234567890","description":"Documento del cliente"},"nombres":{"type":"string","example":"Juan Pérez García","description":"Nombre del cliente"},"email":{"type":"string","example":"j***z@example.com","description":"Email del cliente (parcialmente oculto)"}},"required":["documento","nombres","email"]},"EstadisticasEntity":{"type":"object","properties":{"totalRecargas":{"type":"string","example":"200000","description":"Total de recargas realizadas"},"totalCompras":{"type":"string","example":"75000","description":"Total de compras realizadas"},"numeroRecargas":{"type":"number","example":4,"description":"Número de recargas"},"numeroCompras":{"type":"number","example":3,"description":"Número de compras"}},"required":["totalRecargas","totalCompras","numeroRecargas","numeroCompras"]},"SaldoResponseEntity":{"type":"object","properties":{"cliente":{"$ref":"#/components/schemas/ClienteSaldoEntity"},"saldo":{"type":"string","example":"125000","description":"Saldo actual"},"estadisticas":{"$ref":"#/components/schemas/EstadisticasEntity"},"fechaConsulta":{"type":"string","example":"2025-11-05T10:40:00.000Z","description":"Fecha de consulta"}},"required":["cliente","saldo","estadisticas","fechaConsulta"]}}}}